# データ構造についての考察

JsonPostのデータ構造について考察します。


## データの種類

JsonPostはJsonを格納するストレージとしての機能を主として、利用を適正化するための情報も保持します。
このために、アカウントの管理、システムパラメータ、データ、操作履歴のテーブルを基礎として構築します。


- システムパラメータ  
  永続的な固定パラメータと、他のテーブルから復帰可能なキャッシュデータを保持します。
- アカウント管理  
  アカウントはECDSAのPubKeyに内部的な可読識別子をセットにして表現します。
- データ  
  ファイルアップロードによるデータなどを、重複なく効率的に格納します。
- 操作履歴  
  操作履歴を格納します。このテーブルにはハッシュチェーンを用います。


## ハッシュチェーン

ハッシュチェーンは、ブロックチェーン技術の一種です。
JsonPostでは、サーバーが提示するServerHashChainに指定する識別子（ハッシュ）を生成する目的で使用します。

ハッシュチェーンの始祖は、SeedHashを用いたsha256d(PowStampMessage[SeedHash])です。以降のPowStampは、sha256d(PowStampMessage[-1])で
生成され、ハッシュのチェーンを形成します。

この値は、SeedHashが異なる限り、同一サーバ、サーバ間でも一意な値であることを前提にします。


JsonPostはハッシュチェーンを操作履歴のインデクスとして利用します。

## ハッシュチェーンの種類

ハッシュチェーンはシステムが内部的に使用するMainと、アカウントごとに独立して使用するBranchの２種類があります。


Mainチェーンはアカウントの生成を記録するチェーンです。このチェーンはBranchの起点の履歴となります。

Branchはアカウントの操作履歴を記録するチェーンです。アカウント生成される度にMainのチェーンを引き継いで生成され、
ここに既知となったアカウントの操作履歴が追記されていきます。


MainチェーンはBranch生成毎に自動的に伸長してしまうチェーンであり、無限に伸長します

BranchはPowStamp生成時に加算Nonceを消費するため、寿命があります。
ただし、Godアカウントによる属性操作についてはNonceを消費しません。
これはイレギュラーであり、今後のシステムでは是正されるべきでしょう。