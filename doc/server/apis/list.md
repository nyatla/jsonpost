# /list API仕様

`/list.php` は、JSONドキュメントを検索・取得するためのAPIです。
ページネーション機能を備え、指定した範囲のドキュメント情報をリスト形式で返します。

## リクエストパラメータ

| パラメータ名 | 説明 |
|---|---|
| **index** または **uuid** | リストの先頭位置を指定します。<br>indexの場合は、先頭からの通し番号を指定します。<br>uuidの場合は、指定したUUIDのドキュメントを基準とし、その中で最も古いものを先頭にします。<br>省略時は`index=0`です。 |
| **page** | indexの代替指定方法です。<br>`limit`と組み合わせることで、`limit * page` を先頭位置として計算します。<br>省略時は`page=0`です。 |
| **limit** | 返却する項目数の上限を指定します。<br>省略時は`limit=100`です。 |
| **path** | JSONデータ内の指定したパスが存在するドキュメントのみを返却します。<br>省略時は無視します。 |
| **value** | `path`で指定した要素の値が一致するドキュメントのみを返却します。<br>省略時は無視します。 |

---

### 抽出条件の動作

`limit` で指定した最大件数分のデータを取得した後、その範囲内で`path`および`value`による条件抽出を行います。  
例えば、対象データが1000件存在し、`index=100`、`limit=100`を指定した場合、まず100件目から100件取得し、その中から`path`と`value`に一致するデータを抽出します。  
条件に一致するデータがない場合、返却件数は0件となります。

### パス指定の注意事項

- SQLiteの[JSON1拡張](https://www.sqlite.org/json1.html#jexb)の`json_extract`関数が使用されます。
- 条件式や演算式は指定できません。
- `value`は、指定したパスのノードの文字列表現と完全一致する必要があります。

---

## リクエスト形式

```http
GET /list.php?index=0&limit=100&path=$.title&value="Sample"
```

---

## レスポンス仕様

### 成功時

```json
{
    "success": true,
    "result": {
        "items": [
            [1740805038765, "01955010-e2a3-7368-9b3b-e0ef09caf607"]
        ],
        "index": 100,
        "total": 1000
    }
}
```

### フィールド説明

- **success**  
    処理結果。`true`の場合は成功、`false`の場合は失敗です。

- **result**  
    検索結果の詳細情報です。

    - **items**  
        取得したドキュメント情報のリストです。

        - `[created_date_int, uuid]`  
            各ドキュメントの作成日時(unix-time-ms)、UUIDです。

    - **total**  
        条件に合致する対象レコードの総数です。

---

### 失敗時

エラーが発生した場合は、[`エラーコード`](./errorcodes.md)を参照してください。

